<html>
<head><Title>Media Display Screen</title>
<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
</head>
<body>
<div id="my_media"></div>
<div id="log"></div>


<script>

// Function to change the media
function change_media(cnt, duration) {

 // Make a call to the server to get what we should show
 var request = $.ajax({
  url: "http://localhost:8080/get_media",
  type: "GET",
  datatype: 'json',
  data: { cnt: cnt, duration: duration },
 });

 // Deal with Response
 request.done(function( data ) {
   var obj = jQuery.parseJSON( data );
   var embed_html = '';
   var media_url = false;
   var media_type = false;

   // start with a clean log element
   $( "#log" ).html( "" );

   
   $.each( obj, function( key, value ) {
    if (key = 'media_url') {media_url = true;}
    if (key = 'media_type') {media_type = true;}
   });
   
   if (media_url && media_type) {
    if (obj['media_type'] == 'image') {
     embed_html = '<img src="' +  obj['media_url'] + '"'>';
    } else if (obj['media_type'] == 'quicktime_movie') {
     // TODO: get the correct HTML to embedd quicktime movies in Chrome on Linux
     embed_html = '<movie src="' +  obj['media_url'] + '"'>';
    } else {
     $( "#log" ).html( "Media type not handled: " + obj['media_type'] );
    }
    
    
   } else {
     $( "#log" ).html( "Media type or url not found in: " + data );
   }
   
   $( "#my_media" ).html( data );

  
 });
 
 // Deal with Failure 
 request.fail(function( jqXHR, textStatus ) {
   alert( "Request failed: " + textStatus );
 });
 
 
 

 // last thing it does is set itself up to be called again
 cnt++;
 duration = duration + 50;
  setTimeout(function(){change_media(cnt, duration);}, duration);
 return true;
}


// Start the whole thing running
change_media(0, 50);

</script>
</body>
</html>
